<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="apple-touch-icon" href="s.png">
    <link rel="icon" href="s.png">
    <link rel="manifest" href="manifest.json">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spill Coffee Map - Independent Cafe Culture</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400&display=swap" rel="stylesheet">
    <style>
        :root {
            --cream: #FAF8F5;
            --cream-dark: #F5F2ED;
            --dark: #1A1A1A;
            --gray: #6B6B6B;
            --gray-light: #9A9A9A;
            --accent-pink: #C9A0DC;
            --accent-blue: #7BA3C9;
            --accent-gradient: linear-gradient(135deg, #7BA3C9 0%, #C9A0DC 100%);
            --border: #E5E2DD;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Cormorant Garamond', Georgia, serif;
            background: var(--cream);
            color: var(--dark);
            line-height: 1.7;
            overflow: hidden;
        }

        /* Typewriter effect - preserved */
        .typewriter {
            font-family: 'Space Mono', monospace;
            overflow: hidden;
            border-right: 1px solid var(--dark);
            white-space: nowrap;
            animation: typing-repeat 10s steps(40, end) infinite, blink-caret 0.75s step-end infinite;
            width: 0;
        }

        @keyframes typing-repeat {
            0% { width: 0; }
            25% { width: 100%; }
            100% { width: 100%; }
        }

        @keyframes blink-caret {
            from, to { border-color: transparent; }
            50% { border-color: var(--dark); }
        }
        
        .app-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Header - Sophisticated & Clean */
        header {
            background: var(--cream);
            border-bottom: 1px solid var(--border);
            padding: 20px 40px;
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 40px;
        }
        
        .logo-section {
            display: flex;
            align-items: baseline;
            gap: 32px;
        }
        
        .logo-title h1 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 38px;
            font-weight: 500;
            letter-spacing: 0.02em;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .logo-tagline {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            color: var(--gray);
            display: inline-block;
            max-width: 280px;
        }
        
        .logo-tagline .typewriter {
            display: inline-block;
        }
        
        .header-stats {
            display: flex;
            gap: 16px;
            align-items: center;
        }
        
        .stat-item {
            display: flex;
            align-items: baseline;
            gap: 8px;
            cursor: pointer;
            padding: 8px 16px;
            border: 2px dashed var(--border);
            transition: all 0.2s ease;
        }
        
        .stat-item:hover {
            border-style: solid;
            border-color: var(--accent-blue);
        }
        
        .stat-item.active {
            border-style: solid;
            border-image: var(--accent-gradient) 1;
        }
        
        .stat-item .count {
            font-family: 'Cormorant Garamond', serif;
            font-size: 32px;
            font-weight: 300;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stat-item .label {
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--gray);
        }
        
        .nav-toggle {
            display: flex;
            gap: 4px;
        }
        
        .nav-btn {
            padding: 10px 20px;
            background: transparent;
            border: 1px solid var(--border);
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--dark);
        }
        
        .nav-btn:hover {
            background: var(--cream-dark);
        }
        
        .nav-btn.active {
            background: var(--dark);
            color: var(--cream);
            border-color: var(--dark);
        }
        
        .main-content {
            flex: 1;
            display: flex;
            overflow: hidden;
            position: relative;
        }
        
        /* Map Styles */
        #map {
            flex: 1;
            position: relative;
        }
        
        .map-search-container {
            position: absolute;
            top: 24px;
            left: 24px;
            z-index: 1000;
            display: flex;
            align-items: center;
        }
        
        .map-search-toggle {
            width: 44px;
            height: 44px;
            background: var(--cream);
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .map-search-toggle:hover {
            background: var(--dark);
        }
        
        .map-search-toggle:hover svg {
            fill: var(--cream);
        }
        
        .map-search-toggle svg {
            width: 18px;
            height: 18px;
            fill: var(--dark);
            transition: fill 0.2s ease;
        }
        
        .map-search-input {
            width: 0;
            padding: 0;
            border: 1px solid var(--border);
            border-left: none;
            background: var(--cream);
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            color: var(--dark);
            transition: all 0.3s ease;
            opacity: 0;
        }
        
        .map-search-input.active {
            width: 260px;
            padding: 12px 16px;
            opacity: 1;
        }
        
        .map-search-input:focus {
            outline: none;
            background: white;
        }
        
        .map-search-input::placeholder {
            color: var(--gray-light);
            font-size: 10px;
            letter-spacing: 0.05em;
        }
        
        /* Location Button */
        .location-button {
            position: absolute;
            bottom: 100px;
            left: 24px;
            z-index: 1000;
            width: 44px;
            height: 44px;
            background: var(--cream);
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .location-button:hover,
        .location-button.active {
            background: var(--dark);
        }
        
        .location-button:hover svg,
        .location-button.active svg {
            fill: var(--cream);
        }
        
        .location-button svg {
            width: 18px;
            height: 18px;
            fill: var(--dark);
            transition: fill 0.2s ease;
        }
        
        .user-location-marker {
            width: 14px;
            height: 14px;
            background: var(--accent-blue);
            border: 2px solid white;
            border-radius: 50%;
            box-shadow: 0 0 0 1px var(--dark), 0 2px 8px rgba(0,0,0,0.15);
        }
        
        /* Sponsor Footer */
        .footer-credit {
            position: absolute;
            bottom: 24px;
            right: 24px;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .footer-credit .sponsors-label {
            font-family: 'Space Mono', monospace;
            font-size: 8px;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--gray);
            background: var(--cream);
            padding: 8px 12px;
            border: 1px solid var(--border);
        }
        
        .footer-credit .sponsor-item {
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            letter-spacing: 0.05em;
            color: var(--dark);
            background: var(--cream);
            padding: 8px 12px;
            border: 1px solid var(--border);
            text-decoration: none;
            transition: all 0.2s ease;
        }
        
        .footer-credit .sponsor-item:hover {
            background: var(--dark);
            color: var(--cream);
        }
        
        /* List View */
        #listView {
            flex: 1;
            background: var(--cream);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        #listView::-webkit-scrollbar {
            width: 8px;
        }
        
        #listView::-webkit-scrollbar-track {
            background: var(--cream-dark);
        }
        
        #listView::-webkit-scrollbar-thumb {
            background: var(--border);
        }
        
        .list-header {
            padding: 24px 32px;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
            background: var(--cream);
            z-index: 10;
        }
        
        .search-box {
            width: 100%;
            max-width: 400px;
            padding: 12px 16px;
            border: 1px solid var(--border);
            background: white;
            font-family: 'Space Mono', monospace;
            font-size: 12px;
            color: var(--dark);
            transition: all 0.2s ease;
        }
        
        .search-box:focus {
            outline: none;
            border-color: var(--dark);
        }
        
        .search-box::placeholder {
            color: var(--gray-light);
            font-size: 10px;
            letter-spacing: 0.05em;
        }
        
        #listContent {
            flex: 1;
        }
        
        .list-intro {
            padding: 32px;
            border-bottom: 1px solid var(--border);
            text-align: center;
            background: white;
        }
        
        .list-intro h3 {
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            color: var(--dark);
            margin-bottom: 12px;
        }
        
        .list-intro p {
            font-family: 'Cormorant Garamond', serif;
            font-size: 16px;
            line-height: 1.7;
            color: var(--gray);
            max-width: 500px;
            margin: 0 auto;
        }
        
        .list-intro .partner-badge-inline {
            display: inline-flex;
            vertical-align: middle;
            margin: 0 2px;
        }
        
        .list-footer {
            padding: 40px 32px;
            border-top: 1px solid var(--border);
            text-align: center;
            background: white;
        }
        
        .list-footer h3 {
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            color: var(--dark);
            margin-bottom: 12px;
        }
        
        .list-footer p {
            font-family: 'Cormorant Garamond', serif;
            font-size: 16px;
            line-height: 1.7;
            color: var(--gray);
            max-width: 400px;
            margin: 0 auto 16px;
        }
        
        .state-header {
            padding: 16px 32px;
            background: white;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .state-header:hover {
            background: var(--cream-dark);
        }
        
        .state-header h3 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 24px;
            font-weight: 400;
            letter-spacing: 0.02em;
            color: var(--dark);
            text-align: center;
        }
        
        .city-header {
            padding: 12px 32px 12px 48px;
            background: var(--cream);
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .city-header:hover {
            background: var(--cream-dark);
        }
        
        .city-header h4 {
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            font-weight: 400;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            color: var(--gray);
            text-align: center;
        }
        
        .shop-card {
            padding: 20px 32px;
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            background: var(--cream);
        }
        
        .shop-card:hover {
            background: white;
        }
        
        .shop-name {
            font-family: 'Cormorant Garamond', serif;
            font-size: 20px;
            font-weight: 500;
            color: var(--dark);
            margin-bottom: 4px;
        }
        
        .shop-address {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            color: var(--gray);
            letter-spacing: 0.02em;
            margin-bottom: 12px;
        }
        
        .shop-hours {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            letter-spacing: 0.05em;
            padding: 4px 10px;
            display: inline-block;
            border: 1px solid var(--border);
            margin-bottom: 12px;
        }
        
        .shop-hours.open {
            color: #5A8F5A;
            border-color: #5A8F5A;
        }
        
        .shop-hours.closed {
            color: var(--accent-pink);
            border-color: var(--accent-pink);
        }
        
        .shop-meta {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .shop-type {
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            padding: 6px 12px;
            background: var(--dark);
            color: var(--cream);
            text-decoration: none;
            transition: all 0.2s ease;
        }
        
        .shop-type:hover {
            background: var(--accent-blue);
        }
        
        .shop-type.no-link:hover {
            background: var(--dark);
            cursor: default;
        }
        
        .instagram-link {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            background: var(--dark);
            transition: all 0.2s ease;
            text-decoration: none;
        }
        
        .instagram-link:hover {
            background: var(--accent-pink);
        }
        
        .instagram-link svg {
            width: 14px;
            height: 14px;
            fill: var(--cream);
        }
        
        .directions-buttons {
            display: inline-flex;
            gap: 4px;
        }
        
        .dir-btn {
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            letter-spacing: 0.05em;
            padding: 6px 10px;
            background: transparent;
            color: var(--dark);
            border: 1px solid var(--border);
            text-decoration: none;
            transition: all 0.2s ease;
        }
        
        .dir-btn:hover {
            background: var(--dark);
            color: var(--cream);
            border-color: var(--dark);
        }
        
        .spill-badge {
            position: absolute;
            top: 20px;
            right: 32px;
        }
        
        /* About View - Condensed */
        #aboutView {
            flex: 1;
            background: var(--cream);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        #aboutContent {
            flex: 1;
            padding: 60px 40px;
            max-width: 680px;
            margin: 0 auto;
        }
        
        .about-hero {
            text-align: center;
            margin-bottom: 60px;
        }
        
        .about-hero .kicker {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--gray);
            margin-bottom: 16px;
        }
        
        .about-hero h2 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 56px;
            font-weight: 300;
            letter-spacing: 0.01em;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
        }
        
        .about-hero p {
            font-size: 18px;
            color: var(--gray);
            max-width: 520px;
            margin: 0 auto;
            line-height: 1.7;
        }
        
        .about-section {
            margin-bottom: 48px;
            padding-bottom: 48px;
            border-bottom: 1px solid var(--border);
        }
        
        .about-section:last-child {
            border-bottom: none;
        }
        
        .about-section h3 {
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            letter-spacing: 0.12em;
            text-transform: uppercase;
            color: var(--dark);
            margin-bottom: 16px;
        }
        
        .about-section p {
            font-size: 16px;
            line-height: 1.8;
            color: var(--dark);
            margin-bottom: 12px;
        }
        
        .about-section p:last-child {
            margin-bottom: 0;
        }
        
        .about-section a {
            color: var(--accent-blue);
            text-decoration: none;
            border-bottom: 1px solid transparent;
            transition: border-color 0.2s ease;
        }
        
        .about-section a:hover {
            border-bottom-color: var(--accent-blue);
        }
        
        .culture-list {
            font-size: 16px;
            line-height: 2;
            color: var(--dark);
        }
        
        .partner-badge-inline {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            vertical-align: middle;
        }
        
        .cta-link {
            display: inline-block;
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            padding: 12px 24px;
            background: var(--dark);
            color: var(--cream);
            text-decoration: none;
            margin-top: 16px;
            transition: all 0.2s ease;
        }
        
        .cta-link:hover {
            background: var(--accent-blue);
        }
        
        .cta-link.outline {
            background: transparent;
            color: var(--dark);
            border: 1px solid var(--dark);
        }
        
        .cta-link.outline:hover {
            background: var(--dark);
            color: var(--cream);
        }
        
        /* News View */
        #newsView {
            flex: 1;
            background: var(--cream);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        #newsContent {
            flex: 1;
            padding: 60px 40px;
            max-width: 720px;
            margin: 0 auto;
        }
        
        .news-hero {
            text-align: center;
            margin-bottom: 48px;
        }
        
        .news-hero .kicker {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            letter-spacing: 0.15em;
            text-transform: uppercase;
            color: var(--gray);
            margin-bottom: 12px;
        }
        
        .news-hero h2 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 36px;
            font-weight: 400;
            background: var(--accent-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .news-article {
            padding: 32px 0;
            border-bottom: 1px solid var(--border);
            transition: all 0.2s ease;
        }
        
        .news-article:last-child {
            border-bottom: none;
        }
        
        .news-article .meta {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--gray-light);
            margin-bottom: 12px;
        }
        
        .news-article h3 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 24px;
            font-weight: 500;
            color: var(--dark);
            margin-bottom: 12px;
            line-height: 1.3;
        }
        
        .news-article p {
            font-size: 15px;
            line-height: 1.7;
            color: var(--gray);
            margin-bottom: 16px;
        }
        
        .news-article .read-more {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            color: var(--dark);
            text-decoration: none;
            border-bottom: 1px solid var(--dark);
            padding-bottom: 2px;
            transition: all 0.2s ease;
        }
        
        .news-article .read-more:hover {
            color: var(--accent-blue);
            border-color: var(--accent-blue);
        }
        
        .substack-cta {
            text-align: center;
            padding: 48px 0;
            margin-top: 24px;
        }
        
        .substack-cta p {
            font-size: 14px;
            color: var(--gray);
            margin-bottom: 16px;
        }
        
        /* Map Popup Styles */
        .leaflet-popup-content-wrapper {
            background: var(--cream);
            border: 1px solid var(--border);
            border-radius: 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            font-family: 'Cormorant Garamond', serif;
        }
        
        .leaflet-popup-tip {
            display: none;
        }
        
        .custom-tooltip {
            background: var(--cream);
            border: 1px solid var(--border);
            border-radius: 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            font-family: 'Space Mono', monospace;
            font-size: 11px;
            padding: 6px 12px;
            color: var(--dark);
        }
        
        .custom-tooltip::before {
            display: none;
        }
        
        .popup-content {
            padding: 4px;
        }
        
        .popup-title {
            font-family: 'Cormorant Garamond', serif;
            font-weight: 500;
            font-size: 18px;
            margin-bottom: 4px;
            color: var(--dark);
        }
        
        .popup-address {
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            color: var(--gray);
            margin-bottom: 12px;
        }
        
        .popup-content .shop-hours {
            margin-bottom: 12px;
            font-size: 9px;
        }
        
        .popup-meta {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .popup-type {
            font-family: 'Space Mono', monospace;
            font-size: 9px;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            padding: 4px 10px;
            background: var(--dark);
            color: var(--cream);
            text-decoration: none;
            transition: all 0.2s ease;
        }
        
        .popup-type:hover {
            background: var(--accent-blue);
        }
        
        /* Custom Marker */
        .custom-marker {
            position: relative;
            width: 32px;
            height: 32px;
            background: white;
            border: 2px solid var(--dark);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Space Mono', monospace;
            font-size: 10px;
            font-weight: 700;
            letter-spacing: 0.02em;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .custom-marker::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-top: 8px solid var(--dark);
        }
        
        .custom-marker.black {
            background: var(--dark);
            color: white;
        }
        
        .custom-marker.gradient {
            background: var(--accent-gradient);
            color: white;
            border-color: var(--dark);
        }
        
        .custom-marker:hover,
        .custom-marker.highlight {
            transform: scale(1.2);
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
            z-index: 1000 !important;
        }
        
        .hidden {
            display: none !important;
        }
        
        /* Mobile Responsive */
        @media (max-width: 768px) {
            header {
                padding: 16px 20px;
            }
            
            .header-content {
                flex-direction: column;
                gap: 16px;
            }
            
            .logo-section {
                flex-direction: column;
                align-items: center;
                gap: 8px;
            }
            
            .logo-title h1 {
                font-size: 22px;
            }
            
            .header-stats {
                gap: 12px;
            }
            
            .stat-item {
                padding: 6px 12px;
            }
            
            .stat-item .count {
                font-size: 24px;
            }
            
            .nav-toggle {
                width: 100%;
            }
            
            .nav-btn {
                flex: 1;
                padding: 10px 12px;
                font-size: 9px;
            }
            
            #aboutContent,
            #newsContent {
                padding: 40px 24px;
            }
            
            .about-hero h2 {
                font-size: 32px;
            }
            
            .footer-credit {
                bottom: 16px;
                right: 16px;
                left: 16px;
                justify-content: center;
                flex-wrap: wrap;
            }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .about-section,
        .news-article {
            animation: fadeIn 0.4s ease-out backwards;
        }
        
        .about-section:nth-child(1) { animation-delay: 0.05s; }
        .about-section:nth-child(2) { animation-delay: 0.1s; }
        .about-section:nth-child(3) { animation-delay: 0.15s; }
        .about-section:nth-child(4) { animation-delay: 0.2s; }
        
        .news-article:nth-child(1) { animation-delay: 0.05s; }
        .news-article:nth-child(2) { animation-delay: 0.1s; }
        .news-article:nth-child(3) { animation-delay: 0.15s; }
        .news-article:nth-child(4) { animation-delay: 0.2s; }
    </style>
</head>
<body>
    <div class="app-container">
        <header>
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo-title">
                        <h1>Spill Coffee Map</h1>
                    </div>
                    <div class="logo-tagline">
                        <span class="typewriter">Get Independent Coffee Everywhere</span>
                    </div>
                </div>
                <div class="header-stats">
                    <div class="stat-item" data-filter="partner">
                        <span class="count" id="networkCount">—</span>
                        <span class="label">Partners</span>
                    </div>
                    <div class="stat-item active" data-filter="all">
                        <span class="count" id="shopCount">—</span>
                        <span class="label">Cafes</span>
                    </div>
                </div>
                <div class="nav-toggle">
                    <button class="nav-btn active" data-view="about">About</button>
                    <button class="nav-btn" data-view="map">Map</button>
                    <button class="nav-btn" data-view="list">List</button>
                    <button class="nav-btn" data-view="news">News</button>
                </div>
            </div>
        </header>
        
        <div class="main-content">
            <div id="map" class="hidden">
                <div class="map-search-container">
                    <div class="map-search-toggle" id="mapSearchToggle">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                        </svg>
                    </div>
                    <input type="text" class="map-search-input" id="mapSearchInput" placeholder="Search cafes...">
                </div>
                
                <div class="location-button" id="locationButton" title="Go to my location">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/>
                    </svg>
                </div>
            </div>
            
            <div id="listView" class="hidden">
                <div class="list-header">
                    <input type="text" class="search-box" id="listSearchBox" placeholder="Search cafes...">
                </div>
                <div id="listContent"></div>
            </div>
            
            <div id="aboutView">
                <div id="aboutContent"></div>
            </div>
            
            <div id="newsView" class="hidden">
                <div id="newsContent"></div>
            </div>
            
            <div class="footer-credit">
                <div class="sponsors-label">Supported By</div>
                <a href="https://www.notneutral.com" target="_blank" rel="noopener noreferrer" class="sponsor-item">notNeutral</a>
                <a href="https://thirdwavewater.com" target="_blank" rel="noopener noreferrer" class="sponsor-item">Third Wave Water</a>
            </div>
        </div>
    </div>

    <script>
        // =============================================================
        // CSV IMPORT CONFIGURATION
        // =============================================================
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSmSV7NPuWEwAOauhSt_yhZ_xccnyX5Sux1Xighi_jwZhrSshxVq9shACmv0p8etUB6V9tQ_z4EKiMT/pub?output=csv'
        
        let coffeeShops = [];
        let currentView = 'about';
        let filterMode = 'all';
        let markers = [];
        let map;
        let userLocationMarker = null;
        let userLocation = null;

        // =============================================================
        // GEOLOCATION FUNCTIONS
        // =============================================================
        function getUserLocation() {
            if (!navigator.geolocation) return;

            const locationButton = document.getElementById('locationButton');
            locationButton.classList.add('active');

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    userLocation = { lat, lng };
                    showUserLocation(lat, lng);
                    map.setView([lat, lng], 13, { animate: true });
                    locationButton.classList.remove('active');
                },
                (error) => {
                    locationButton.classList.remove('active');
                    if (!userLocation) map.setView([39.9833, -83.0167], 12);
                }
            );
        }

        function showUserLocation(lat, lng) {
            if (userLocationMarker) map.removeLayer(userLocationMarker);
            
            const userIcon = L.divIcon({
                html: '<div class="user-location-marker"></div>',
                className: '',
                iconSize: [14, 14],
                iconAnchor: [7, 7]
            });
            
            userLocationMarker = L.marker([lat, lng], { icon: userIcon })
                .addTo(map)
                .bindTooltip('You are here', {
                    permanent: false,
                    direction: 'top',
                    offset: [0, -8],
                    className: 'custom-tooltip'
                });
        }

        function initializeMapPosition() {
            if (!navigator.geolocation) {
                map.setView([39.9833, -83.0167], 12);
                return;
            }

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    userLocation = { lat, lng };
                    showUserLocation(lat, lng);
                    map.setView([lat, lng], 13);
                },
                () => map.setView([39.9833, -83.0167], 12)
            );
        }

        document.getElementById('locationButton').addEventListener('click', getUserLocation);

        // =============================================================
        // CSV PARSING FUNCTIONS
        // =============================================================
        function parseCSV(csv) {
            const lines = csv.split('\n');
            const headers = lines[0].split(',');
            const data = [];
            
            for (let i = 1; i < lines.length; i++) {
                if (!lines[i].trim()) continue;
                const values = lines[i].split(',');
                const obj = {};
                headers.forEach((header, index) => {
                    obj[header.trim()] = values[index] ? values[index].trim() : '';
                });
                data.push(obj);
            }
            return data;
        }

        function convertToShopFormat(csvRow) {
            const website = csvRow.website === '__' || !csvRow.website ? null : csvRow.website;
            const instagram = csvRow.instagram === '__' || !csvRow.instagram ? csvRow.instagram.replace(/__/g, '') : csvRow.instagram;
            const isPartner = csvRow.isPartner?.toUpperCase() === 'TRUE';
            
            let hours = null;
            if (csvRow.sun_open && csvRow.sun_close) {
                hours = { periods: [] };
                const days = ['sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat'];
                days.forEach((day, index) => {
                    if (csvRow[`${day}_open`] && csvRow[`${day}_close`]) {
                        hours.periods.push({
                            open: { day: index, time: csvRow[`${day}_open`] },
                            close: { day: index, time: csvRow[`${day}_close`] }
                        });
                    }
                });
            }
            
            return {
                name: csvRow.name,
                address: csvRow.address,
                city: csvRow.city || '',
                state: csvRow.state || '',
                lat: parseFloat(csvRow.lat),
                lng: parseFloat(csvRow.lng),
                type: csvRow.type,
                website: website,
                instagram: instagram,
                isPartner: isPartner,
                initials: csvRow.initials || null,
                hours: hours
            };
        }

        // =============================================================
        // LOAD DATA FROM CSV
        // =============================================================
        async function loadCafeData() {
            try {
                const response = await fetch(CSV_URL);
                const csvText = await response.text();
                const csvData = parseCSV(csvText);
                
                coffeeShops = csvData.map(convertToShopFormat);
                
                document.getElementById('shopCount').textContent = coffeeShops.length;
                document.getElementById('networkCount').textContent = coffeeShops.filter(s => s.isPartner).length;
                
                initializeMap();
            } catch (error) {
                console.error('Error loading cafe data:', error);
                document.getElementById('shopCount').textContent = '—';
                document.getElementById('networkCount').textContent = '—';
            }
        }

        // =============================================================
        // HELPER FUNCTIONS
        // =============================================================
        function getInitials(shop) {
            if (shop.initials) return shop.initials.toUpperCase();
            const words = shop.name.replace(/—/g, ' ').split(' ');
            if (words.length === 1) return words[0].substring(0, 2).toUpperCase();
            return (words[0][0] + words[1][0]).toUpperCase();
        }

        function getHoursDisplay(shop) {
            if (!shop.isPartner || !shop.hours) return null;
            return formatHoursText(shop.hours);
        }
        
        function formatHoursText(openingHours) {
            if (!openingHours || !openingHours.periods) return null;
            
            const now = new Date();
            const currentDay = now.getDay();
            const currentTime = now.getHours() * 100 + now.getMinutes();
            const pluralDays = ['Sundays', 'Mondays', 'Tuesdays', 'Wednesdays', 'Thursdays', 'Fridays', 'Saturdays'];
            
            const todaysPeriod = openingHours.periods.find(p => p.open.day === currentDay);
            
            if (!todaysPeriod) {
                let nextDay = (currentDay + 1) % 7;
                let daysChecked = 0;
                while (daysChecked < 7) {
                    const nextPeriod = openingHours.periods.find(p => p.open.day === nextDay);
                    if (nextPeriod) {
                        return { text: `Opens ${formatTime(nextPeriod.open.time)} on ${pluralDays[nextDay]}`, isOpen: false };
                    }
                    nextDay = (nextDay + 1) % 7;
                    daysChecked++;
                }
                return { text: 'Hours unavailable', isOpen: false };
            }
            
            const openTime = parseInt(todaysPeriod.open.time);
            const closeTime = todaysPeriod.close ? parseInt(todaysPeriod.close.time) : 2359;
            const isOpen = currentTime >= openTime && currentTime < closeTime;
            
            if (isOpen) {
                return { text: `Open til ${formatTime(todaysPeriod.close.time)}`, isOpen: true };
            } else if (currentTime < openTime) {
                return { text: `Opens ${formatTime(todaysPeriod.open.time)}`, isOpen: false };
            } else {
                let nextDay = (currentDay + 1) % 7;
                let daysChecked = 0;
                while (daysChecked < 7) {
                    const nextPeriod = openingHours.periods.find(p => p.open.day === nextDay);
                    if (nextPeriod) {
                        return { text: `Opens ${formatTime(nextPeriod.open.time)} ${pluralDays[nextDay]}`, isOpen: false };
                    }
                    nextDay = (nextDay + 1) % 7;
                    daysChecked++;
                }
            }
            return { text: 'Hours unavailable', isOpen: false };
        }
        
        function formatTime(timeString) {
            if (!timeString) return '';
            const time = timeString.toString().padStart(4, '0');
            let hours = parseInt(time.substring(0, 2));
            const minutes = time.substring(2, 4);
            const ampm = hours >= 12 ? 'pm' : 'am';
            if (hours === 0) hours = 12;
            else if (hours > 12) hours -= 12;
            return minutes === '00' ? `${hours}${ampm}` : `${hours}:${minutes}${ampm}`;
        }

        // =============================================================
        // MAP INITIALIZATION
        // =============================================================
        function initializeMap() {
            map = L.map('map', { zoomControl: false }).setView([39.9833, -83.0167], 12);
            L.control.zoom({ position: 'bottomleft' }).addTo(map);

            L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
                attribution: '© OpenStreetMap, © CartoDB',
                maxZoom: 19
            }).addTo(map);

            initializeMapPosition();
            createMarkers();
        }

        function createMarkers() {
            coffeeShops.forEach((shop, index) => {
                const googleMapsUrl = `https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(shop.address)}`;
                const appleMapsUrl = `https://maps.apple.com/?daddr=${encodeURIComponent(shop.address)}`;
                const initials = getInitials(shop);
                const markerClass = shop.isPartner ? 'gradient' : 'black';
                
                const customIcon = L.divIcon({
                    html: `<div class="custom-marker ${markerClass}" data-index="${index}">${initials}</div>`,
                    className: '',
                    iconSize: [32, 40],
                    iconAnchor: [16, 40]
                });
                
                const instagramIcon = shop.instagram ? `
                    <a href="https://instagram.com/${shop.instagram}" target="_blank" rel="noopener noreferrer" class="instagram-link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                        </svg>
                    </a>
                ` : '';
                
                const popupTypeLink = shop.website ? 
                    `<a href="${shop.website}" target="_blank" rel="noopener noreferrer" class="popup-type">${shop.type}</a>` : 
                    `<span class="popup-type">${shop.type}</span>`;
                
                const hoursData = getHoursDisplay(shop);
                const hoursHTML = hoursData ? `<div class="shop-hours ${hoursData.isOpen ? 'open' : 'closed'}">${hoursData.text}</div>` : '';
                
                const marker = L.marker([shop.lat, shop.lng], { icon: customIcon })
                    .addTo(map)
                    .bindTooltip(shop.name, {
                        permanent: false,
                        direction: 'top',
                        offset: [0, -16],
                        className: 'custom-tooltip'
                    })
                    .bindPopup(`
                        <div class="popup-content">
                            <div class="popup-title">${shop.name}</div>
                            <div class="popup-address">${shop.address}</div>
                            ${hoursHTML}
                            <div class="popup-meta">
                                ${popupTypeLink}
                                ${instagramIcon}
                            </div>
                            <div class="directions-buttons">
                                <a href="${googleMapsUrl}" target="_blank" class="dir-btn" rel="noopener noreferrer">Google</a>
                                <a href="${appleMapsUrl}" target="_blank" class="dir-btn" rel="noopener noreferrer">Apple</a>
                            </div>
                        </div>
                    `, { closeButton: true, autoClose: true, closeOnClick: false });
                
                marker.on('popupopen', () => {
                    const popup = marker.getPopup();
                    const popupElement = popup.getElement();
                    popupElement.querySelectorAll('a').forEach(link => {
                        link.addEventListener('click', (e) => {
                            if (link.href) {
                                e.preventDefault();
                                e.stopPropagation();
                                window.open(link.href, '_blank', 'noopener,noreferrer');
                            }
                        });
                    });
                });
                
                markers.push({ marker, shop, index });
            });
        }

        // =============================================================
        // FILTER FUNCTIONALITY
        // =============================================================
        function filterCafes(mode) {
            filterMode = mode;
            
            document.querySelectorAll('.stat-item').forEach(item => {
                item.classList.toggle('active', item.dataset.filter === mode);
            });
            
            markers.forEach(({ marker, shop }) => {
                if (mode === 'partner') {
                    shop.isPartner ? marker.addTo(map) : map.removeLayer(marker);
                } else {
                    marker.addTo(map);
                }
            });
            
            if (currentView === 'list') renderListView();
        }
        
        document.querySelectorAll('.stat-item').forEach(item => {
            item.addEventListener('click', () => filterCafes(item.dataset.filter));
        });

        // =============================================================
        // VIEW TOGGLE FUNCTIONALITY
        // =============================================================
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const view = btn.dataset.view;
                currentView = view;
                
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                document.getElementById('map').classList.add('hidden');
                document.getElementById('listView').classList.add('hidden');
                document.getElementById('aboutView').classList.add('hidden');
                document.getElementById('newsView').classList.add('hidden');
                
                if (view === 'map') {
                    document.getElementById('map').classList.remove('hidden');
                    setTimeout(() => map.invalidateSize(), 100);
                } else if (view === 'list') {
                    document.getElementById('listView').classList.remove('hidden');
                    renderListView();
                } else if (view === 'about') {
                    document.getElementById('aboutView').classList.remove('hidden');
                    renderAboutView();
                } else if (view === 'news') {
                    document.getElementById('newsView').classList.remove('hidden');
                    renderNewsView();
                }
            });
        });

        // =============================================================
        // LIST VIEW RENDER
        // =============================================================
        function renderListView(searchQuery = '') {
            const listContent = document.getElementById('listContent');
            
            const filteredShops = coffeeShops.filter(shop => {
                if (filterMode === 'partner' && !shop.isPartner) return false;
                if (searchQuery) {
                    const searchText = `${shop.name} ${shop.address} ${shop.type}`.toLowerCase();
                    return searchText.includes(searchQuery.toLowerCase());
                }
                return true;
            });
            
            filteredShops.sort((a, b) => {
                if (a.state !== b.state) return a.state.localeCompare(b.state);
                if (a.city !== b.city) return a.city.localeCompare(b.city);
                return a.name.localeCompare(b.name);
            });
            
            // Partner Cafes intro at top
            let html = `
                <div class="list-intro">
                    <h3>Partner Cafes</h3>
                    <p>Cafes with the <span class="partner-badge-inline"><svg width="16" height="16" viewBox="0 0 24 24"><defs><linearGradient id="gList" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#7BA3C9"/><stop offset="100%" style="stop-color:#C9A0DC"/></linearGradient></defs><circle cx="12" cy="12" r="11" fill="url(#gList)" stroke="#1A1A1A" stroke-width="1"/><text x="12" y="16" font-family="Arial" font-size="10" font-weight="bold" fill="white" text-anchor="middle">S</text></svg></span> badge are official Spill Coffee Map partners who have worked directly with us to share their story.</p>
                </div>
            `;
            
            if (filteredShops.length === 0) {
                listContent.innerHTML = html + '<div style="padding: 60px; text-align: center; color: var(--gray);">No cafes found.</div>';
                return;
            }
            
            const stateGroups = {};
            filteredShops.forEach(shop => {
                const state = shop.state || 'Unknown';
                const city = shop.city || 'Unknown';
                if (!stateGroups[state]) stateGroups[state] = {};
                if (!stateGroups[state][city]) stateGroups[state][city] = [];
                stateGroups[state][city].push(shop);
            });
            
            const stateNames = { 'OH': 'Ohio', 'CA': 'California', 'NY': 'New York', 'TX': 'Texas', 'FL': 'Florida', 'IL': 'Illinois', 'MI': 'Michigan' };
            
            Object.keys(stateGroups).sort().forEach(state => {
                const stateId = `state-${state}`;
                html += `<div class="state-header" data-state-id="${stateId}"><h3>${stateNames[state] || state}</h3></div>
                         <div class="state-cities" id="${stateId}" style="display: none;">`;
                
                Object.keys(stateGroups[state]).sort().forEach(city => {
                    const cityId = `city-${state}-${city}`.replace(/\s+/g, '-');
                    html += `<div class="city-header" data-city-id="${cityId}"><h4>${city}</h4></div>
                             <div class="city-cafes" id="${cityId}" style="display: none;">`;
                    
                    stateGroups[state][city].forEach(shop => {
                        const actualIndex = coffeeShops.indexOf(shop);
                        const googleMapsUrl = `https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(shop.address)}`;
                        const appleMapsUrl = `https://maps.apple.com/?daddr=${encodeURIComponent(shop.address)}`;
                        
                        const typeLink = shop.website ? 
                            `<a href="${shop.website}" target="_blank" rel="noopener noreferrer" class="shop-type">${shop.type}</a>` : 
                            `<span class="shop-type no-link">${shop.type}</span>`;
                        
                        const instagramIcon = shop.instagram ? `
                            <a href="https://instagram.com/${shop.instagram}" target="_blank" rel="noopener noreferrer" class="instagram-link">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
                            </a>` : '';
                        
                        const spillBadge = shop.isPartner ? 
                            `<div class="spill-badge"><svg width="20" height="20" viewBox="0 0 24 24"><defs><linearGradient id="g${actualIndex}" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#7BA3C9"/><stop offset="100%" style="stop-color:#C9A0DC"/></linearGradient></defs><circle cx="12" cy="12" r="11" fill="url(#g${actualIndex})" stroke="#1A1A1A" stroke-width="1"/><text x="12" y="16" font-family="Arial" font-size="10" font-weight="bold" fill="white" text-anchor="middle">S</text></svg></div>` : '';
                        
                        html += `
                            <div class="shop-card">
                                <div class="shop-name">${shop.name}</div>
                                <div class="shop-address">${shop.address}</div>
                                <div class="shop-hours-placeholder" data-shop-index="${actualIndex}"></div>
                                <div class="shop-meta">
                                    ${typeLink}
                                    ${instagramIcon}
                                    <div class="directions-buttons">
                                        <a href="${googleMapsUrl}" target="_blank" rel="noopener noreferrer" class="dir-btn">Google</a>
                                        <a href="${appleMapsUrl}" target="_blank" rel="noopener noreferrer" class="dir-btn">Apple</a>
                                    </div>
                                </div>
                                ${spillBadge}
                            </div>`;
                    });
                    html += `</div>`;
                });
                html += `</div>`;
            });
            
            // Suggest a Cafe footer at bottom
            html += `
                <div class="list-footer">
                    <h3>Suggest a Cafe</h3>
                    <p>Know an independent coffee shop that embodies the culture of care? We're always looking to expand our map.</p>
                    <a href="https://forms.gle/your-form-id" target="_blank" class="cta-link outline">Submit a Recommendation</a>
                </div>
            `;
            
            listContent.innerHTML = html;
            
            // Add event listeners
            setTimeout(() => {
                document.querySelectorAll('.state-header').forEach(header => {
                    header.addEventListener('click', () => {
                        const stateId = header.dataset.stateId;
                        const container = document.getElementById(stateId);
                        const isExpanded = container.style.display === 'block';
                        document.querySelectorAll('.state-cities').forEach(c => c.style.display = 'none');
                        if (!isExpanded) container.style.display = 'block';
                    });
                });
                
                document.querySelectorAll('.city-header').forEach(header => {
                    header.addEventListener('click', () => {
                        const cityId = header.dataset.cityId;
                        const container = document.getElementById(cityId);
                        const isExpanded = container.style.display === 'block';
                        document.querySelectorAll('.city-cafes').forEach(c => c.style.display = 'none');
                        if (!isExpanded) container.style.display = 'block';
                    });
                });
                
                // Populate hours
                filteredShops.forEach(shop => {
                    const actualIndex = coffeeShops.indexOf(shop);
                    const placeholder = listContent.querySelector(`[data-shop-index="${actualIndex}"]`);
                    if (placeholder) {
                        const hoursData = getHoursDisplay(shop);
                        if (hoursData) {
                            placeholder.innerHTML = `<div class="shop-hours ${hoursData.isOpen ? 'open' : 'closed'}">${hoursData.text}</div>`;
                        }
                    }
                });
            }, 0);
        }

        document.getElementById('listSearchBox').addEventListener('input', (e) => renderListView(e.target.value));

        // =============================================================
        // ABOUT VIEW - RESTRUCTURED
        // =============================================================
        function renderAboutView() {
            document.getElementById('aboutContent').innerHTML = `
                <div class="about-hero">
                    <p class="kicker">Spill Coffee Map</p>
                    <h2>Independent Coffee.</h2>
                    <p>We showcase local and independent cafes that prioritize genuine connection over transactional efficiency.</p>
                </div>
                
                <div class="about-section">
                    <h3>Our Mission</h3>
                    <p>Spill Coffee Map exists to help you discover independent coffee shops that prioritize genuine human connection over transactional relationships. We believe coffee culture is about more than just great drinks—it's about the spaces and people that make communities thrive.</p>
                </div>
                
                <div class="about-section">
                    <h3>Partner Cafes</h3>
                    <p>Cafes with the <span class="partner-badge-inline"><svg width="18" height="18" viewBox="0 0 24 24"><defs><linearGradient id="gAbout" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" style="stop-color:#7BA3C9"/><stop offset="100%" style="stop-color:#C9A0DC"/></linearGradient></defs><circle cx="12" cy="12" r="11" fill="url(#gAbout)" stroke="#1A1A1A" stroke-width="1"/><text x="12" y="16" font-family="Arial" font-size="10" font-weight="bold" fill="white" text-anchor="middle">S</text></svg></span> badge are official Spill partners. Not only are all of our partners independent but they are commited to their communties and to serving high quality, specialty grade coffee. Support these cafes by purchasing a Spill Coffee Badge and receive a discount at any of these locations!</p>
                </div>
                
                <div class="about-section">
                    <h3>About Spill</h3>
                    <p>Spill is a coffee culture media brand documenting the cafes, roasters, and people building meaningful community through coffee. Founded by photographer and former cafe owner <a href="https://instagram.com/lukeleffel" target="_blank">Luke Leffel</a>, we're creating a national network of independent coffee spaces worth visiting.</p>
                    <p>Follow <a href="https://instagram.com/spillcoffeemag" target="_blank">@spillcoffeemag</a> · Visit <a href="https://spillcoffeemag.com" target="_blank">spillcoffeemag.com</a></p>
                </div>
                
                <div class="about-section">
                    <h3>Partner With Us</h3>
                    <p>Join the growing network of independent cafes featured on Spill Coffee Map. Partner cafes receive featured placement with the Spill badge, professional photography documentation, feature coverage in Spill Coffee Magazine, and access to our nationwide network of coffee enthusiasts.</p>
                    <p><strong>Annual Partnership:</strong> $500/year includes badge placement, photography session, and feature story.</p>
                    <p style="margin-top: 8px; font-size: 14px; color: var(--gray);">Questions? Email <a href="mailto:luke@spillcoffeemag.com">luke@spillcoffeemag.com</a></p>
                    <a href="mailto:luke@spillcoffeemag.com" class="cta-link outline">Apply to Partner</a>
                </div>
                
                <div class="about-section">
                    <h3>Get Your Spill Keychain</h3>
                    <p>Show your support for independent coffee culture with the official Spill Coffee Map keychain. Proceeds help us continue documenting and connecting coffee communities across the country.</p>
                    <a href="https://spillcoffeemag.com/shop" target="_blank" class="cta-link">Shop Keychains</a>
                </div>
            `;
        }

        // =============================================================
        // NEWS VIEW
        // =============================================================
        function renderNewsView() {
            document.getElementById('newsContent').innerHTML = `
                <div class="news-hero">
                    <p class="kicker">From the Magazine</p>
                    <h2>Latest Stories</h2>
                </div>
                
                <div class="news-article">
                    <p class="meta">January 2026 · Culture</p>
                    <h3>The Quiet Revolution of Third Spaces</h3>
                    <p>How independent cafes are reclaiming community gathering in an age of isolation and remote work.</p>
                    <a href="https://spillcoffeemagazine.substack.com" target="_blank" class="read-more">Read More</a>
                </div>
                
                <div class="news-article">
                    <p class="meta">December 2025 · Interview</p>
                    <h3>Building Fox in the Snow: A Conversation with Jeff Davis</h3>
                    <p>The founder of Columbus's beloved cafe reflects on ten years of creating intentional spaces.</p>
                    <a href="https://spillcoffeemagazine.substack.com" target="_blank" class="read-more">Read More</a>
                </div>
                
                <div class="news-article">
                    <p class="meta">December 2025 · Opinion</p>
                    <h3>Why Your Favorite Cafe Doesn't Have an App</h3>
                    <p>The intentional friction of ordering at the counter—and why it matters more than ever.</p>
                    <a href="https://spillcoffeemagazine.substack.com" target="_blank" class="read-more">Read More</a>
                </div>
                
                <div class="news-article">
                    <p class="meta">November 2025 · Guide</p>
                    <h3>A Weekend in Detroit's Independent Coffee Scene</h3>
                    <p>From Anthology to Madcap, exploring the cafes shaping Motor City's third wave.</p>
                    <a href="https://spillcoffeemagazine.substack.com" target="_blank" class="read-more">Read More</a>
                </div>
                
                <div class="substack-cta">
                    <p>Subscribe for weekly stories on independent coffee culture.</p>
                    <a href="https://spillcoffeemagazine.substack.com" target="_blank" class="cta-link">Visit Substack</a>
                </div>
            `;
        }

        // =============================================================
        // MAP SEARCH FUNCTIONALITY
        // =============================================================
        const mapSearchToggle = document.getElementById('mapSearchToggle');
        const mapSearchInput = document.getElementById('mapSearchInput');
        
        mapSearchToggle.addEventListener('click', () => {
            mapSearchInput.classList.toggle('active');
            if (mapSearchInput.classList.contains('active')) {
                mapSearchInput.focus();
            } else {
                mapSearchInput.value = '';
                markers.forEach(({ marker }) => marker.setOpacity(1));
            }
        });
        
        mapSearchInput.addEventListener('input', (e) => {
            const query = e.target.value.toLowerCase();
            if (!query) {
                markers.forEach(({ marker }) => marker.setOpacity(1));
                return;
            }
            markers.forEach(({ marker, shop }) => {
                const searchText = `${shop.name} ${shop.address} ${shop.type}`.toLowerCase();
                marker.setOpacity(searchText.includes(query) ? 1 : 0.2);
            });
        });

        mapSearchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const query = e.target.value.toLowerCase();
                if (!query) return;
                const firstMatch = markers.find(({ shop }) => 
                    `${shop.name} ${shop.address} ${shop.type}`.toLowerCase().includes(query)
                );
                if (firstMatch) map.setView([firstMatch.shop.lat, firstMatch.shop.lng], 15, { animate: true });
            }
        });
        
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.map-search-container')) {
                mapSearchInput.classList.remove('active');
                mapSearchInput.value = '';
                markers.forEach(({ marker }) => marker.setOpacity(1));
            }
        });

        // =============================================================
        // INITIALIZE
        // =============================================================
        loadCafeData();
        renderAboutView();
    </script>
    <script>
        if ("serviceWorker" in navigator) {
            navigator.serviceWorker.register("service-worker.js");
        }
    </script>
</body>
</html>
